# 플러그인 기능 명세서
<hr>

## Overview
<hr>

- 매번 커밋 시 적어야 하는 커밋 메시지를 **자동생성**하기 위해 플러그인을 제작
- 생성되는 커밋 메시지는 [**AngularJS의 커밋 메시지 컨벤션**](https://docs.google.com/document/d/1QrDFcIiPjSLDn3EL15IJygNPiHORgU1_OOAqWjiDU5Y/edit#heading=h.uyo6cb12dt6w)을 따름
- 기존의 다른 영어권 플러그인과 달리, **한국어 커밋 메시지 생성 지원**
- **사용성을 극대화**하기 위해 **IDE 좌측의 Commit탭의 아이콘 클릭**만으로 메시지를 생성할 수 있도록 지원

<br>
<br>

## Use Case
<hr>

### S0: 필요 정보 세팅 (최초 실행 시)
- **액터**: 사용자
- **설명**:
  1. 사용자가 IntelliJ에서 `File > Other Settings > Commit Message Generator` 항목을 선택한다.
  2. 사용자가 **ChatGPT API 키와 모델을 설정**한다.

<br>

### S1: Commit 탭에서의 파일 선택, 아이콘 클릭
- **액터**: 사용자
- **설명**:
  1. 사용자가 **IntelliJ 좌측의 Commit 탭을 연다**.
  2. 사용자가 Commit할 파일을 **Changes 목록에서 체크**한다.
  3. 사용자가 Commit 탭 내부의 **플러그인 아이콘을 클릭**한다.
  4. 플러그인이 활성화된다.
- **사전 조건**:
  - IntelliJ와 프로젝트가 **GitHub에 연동**되어 있어야 한다.

<br>

### S2: 변경 내역 종합 및 ChatGPT에게 요청
- **액터**: 플러그인
- **설명**:
  1. 플러그인이 S1에서 선택된 파일의 **변경 내역을 종합**한다.
  2. 플러그인이 종합된 **변경 내역과 커밋 메시지 프롬프트를 결합**한다.
  3. 플러그인이 **ChatGPT API를 통해 커밋 메시지 생성을 요청**한다.
  4. **ChatGPT가 생성한 커밋 메시지를 플러그인에 반환**한다.
- **사전 조건**:
  - ChatGPT API 키가 설정에 입력되어 있어야 한다.

<br>

### S3: 커밋 메시지 자동 삽입 및 커밋
- **액터**: 사용자, 플러그인
- **설명**:
  1. 플러그인이 S2에서 생성된 커밋 메시지를 **Commit 탭의 메시지 창에 자동으로 삽입**한다.
  2. 사용자가 **생성된 커밋 메시지를 확인**한다.
  3. 사용자가 필요에 따라 커밋 메시지를 수정한다.
  4. 사용자가 최종적으로 **커밋을 완료**한다.

<br>
<br>

## Detail Feature
<hr>

- 완료한 기능은 기능 옆에 ✅ 이모지를 통해 반영한다.
- 기능 명세는 구현 중에 언제든 추가될 수 있다.
- 예외처리는 구현 중에 계속하여 추가한다.

<br>

### 1. 선택된 항목의 변경사항 가져오기
#### 동작
1. 사용자가 Commit 탭에서 **변경할 파일을 선택**한다.
2. 플러그인은 선택된 파일의 변경 내역을 **Git Diff를 통해 확인**하여 **변경된 라인, 추가된 파일, 삭제된 파일**을 식별한다.
3. 식별한 데이터를 **내부 데이터 구조에 저장**한다.

#### 예외처리
- 선택된 파일이 없을 경우 사용자에게 오류 메시지를 표시한다.
    ```
    [ERROR] 커밋할 파일이 선택되지 않았습니다.
    ```

<br>

### 2. 선택된 변경사항을 적절히 포맷팅
#### 동작
1. 변경된 데이터를 담은 **자료구조를 파싱**한다.
2. 파싱된 정보를 ChatGPT가 **이해하기 쉬운 형태의 Text로 변환**한다.

#### 예외처리
- 변경 내역이 비어 있는 경우 사용자에게 오류 메시지를 표시한다.
    ```
    [ERROR] 변경 내역이 없습니다.
    ```
- 변경 내역이 너무 많은 경우 사용자에게 오류 메시지를 표시한다.
    ```
    [ERROR] 변경 내역이 너무 많습니다. 다시 선택해 주세요.
    ```

<br>

### 3. 프롬프트와 변경사항을 결합하여 ChatGPT에게 전달
#### 동작
1. 사전에 준비된 **커밋 메시지 생성 프롬프트와 변경내역을 적절히 결합**한다.
2. 결합한 내용을 **HTTP의 Body에 넣어서 ChatGPT API로 요청**을 보낸다.
3. 플러그인은 **ChatGPT API로부터 응답을 기다린다**.

#### 예외처리
- ChatGPT API 호출 실패 시 사용자에게 오류 메시지를 표시한다.
    ```
    [ERROR] 커밋 메시지 생성 요청 실패. 다시 시도해 주세요.
    ```

<br>

### 4. 응답으로 온 메시지를 커밋탭의 메시지창에 추가
#### 동작
1. 플러그인은 응답에서 **커밋 메시지를 추출**한다.
2. 추출한 커밋 메시지를 **Commit 탭의 메시지 창에 자동으로 삽입**한다.

#### 예외처리
- 응답 메시지가 비어 있는 경우 사용자에게 오류 메시지를 표시한다.
    ```
    [ERROR] 생성된 커밋 메시지가 없습니다.
    ```

<br>
<br>

## Complement
<hr>

### Diff 종류
- **Unchanged**: 변경되지 않은 부분
- **Added**: 새로 추가된 부분
- **Deleted**: 삭제된 부분
- **Modified**: 변경된 부분

### GPT API 모델 설명
- **모델**:
  - **4o**: 최상의 성능을 제공하는 모델.
  - **4o mini**: 기본값으로 설정된 모델, 빠르고 효율적임.
  - **4**: 성능과 효율성의 균형을 맞춘 모델.
  - **3.5**: 가장 기본적인 모델, 빠른 응답을 제공하지만 성능은 다소 낮음.

- **기본값**: 4o mini
